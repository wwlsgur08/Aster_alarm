<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aster Alarm – 나만의 매력 벨소리 생성하기 (v2.0)</title>
    <link rel="stylesheet" href="./styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <!-- 별자리 배경 -->
    <div class="starry-background"></div>

    <div class="main-container">
      <!-- 로고 -->
      <div class="logo-container">
        <img src="./images/logo.png" alt="Aster Alarm Logo" class="logo-image">
      </div>

      <!-- 제목 -->
      <h1 class="main-title">나만의 매력 벨소리 생성하기</h1>

      <!-- 음악 플레이어 -->
      <div class="music-player" id="music-player">
        <div class="player-container">
          <div class="player-info">
            <div class="track-title" id="track-title">🎵 생성된 음악이 여기에 표시됩니다</div>
            <div class="track-subtitle" id="track-subtitle">매력을 선택하고 음악을 생성해보세요</div>
          </div>
          
          <div class="player-controls">
            <button class="play-btn" id="play-btn" disabled>
              <span class="play-icon">▶</span>
            </button>
            <button class="download-btn" id="download-btn" disabled>
              <span class="download-icon">💾</span>
            </button>
          </div>
          
          <div class="progress-container">
            <div class="progress-bar" id="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="time-display">
              <span id="current-time">0:00</span>
              <span id="total-time">0:00</span>
            </div>
          </div>
        </div>
        
        <audio id="audio-player" preload="none"></audio>
      </div>

      <!-- 이름 입력 -->
      <div class="name-section">
        <label for="user-name" class="input-label">이름</label>
        <input 
          type="text" 
          id="user-name" 
          class="name-input" 
          placeholder="이름을 입력하세요"
        />
      </div>

      <!-- 시간 슬라이더 -->
      <div class="duration-section">
        <label class="input-label">
          벨소리 길이: <span id="duration-display" class="duration-value">1분 00초</span>
        </label>
        <input 
          type="range" 
          id="duration_select" 
          class="duration-slider" 
          min="30" 
          max="120" 
          value="60"
        />
      </div>

      <!-- 매력 선택 섹션 -->
      <div class="charm-section">
        <h2 class="section-title">매력 선택</h2>
        <div id="traits-container" class="charm-container"></div>
        
        <!-- 매력 추가 버튼 -->
        <button id="add-trait" type="button" class="add-charm-btn">
          <span class="plus-icon">+</span> 매력 추가
        </button>
      </div>

      <!-- 음악 생성 버튼 -->
      <button id="generate" type="button" class="generate-btn" disabled>
        <span class="music-icon">🎵</span>
        <span class="btn-text">음악 생성하기</span>
        <div class="loading-spinner hidden"></div>
      </button>

      <!-- 상태 표시 -->
      <div id="gen-status" class="status-display"></div>

      <!-- 설정 버튼 (톱니바퀴) -->
      <button id="settings-toggle" type="button" class="settings-btn" title="설정">
        ⚙️
      </button>

      <!-- JSON 관리 버튼들 (숨김) -->
      <div class="json-controls hidden">
        <button id="clear-traits" type="button" class="secondary-btn">초기화</button>
        <button id="export-json" type="button" class="secondary-btn">JSON 내보내기</button>
        <button id="load-json" type="button" class="secondary-btn">JSON 불러오기</button>
        <textarea id="traits-json" class="json-textarea hidden" rows="6" placeholder='{
  "traits": [
    {"charm_name": "침착성", "stage": 6},
    {"charm_name": "안정감", "stage": 5}
  ]
}'></textarea>
      </div>
    </div>

    <!-- 설정 모달 -->
    <div id="settings-modal" class="modal hidden" aria-hidden="true">
      <div class="modal-content settings-modal-content">
        <div class="modal-header">
          <strong>설정</strong>
          <button id="settings-close" type="button" class="close-btn">×</button>
        </div>
        <div class="settings-body">
          <div class="setting-group">
            <label for="api-endpoint" class="setting-label">API 엔드포인트</label>
            <input id="api-endpoint" class="setting-input" placeholder="/api/generate" />
          </div>

          <div class="settings-actions">
            <button id="save-settings" type="button" class="save-settings-btn">설정 저장</button>
          </div>
          
          <div class="settings-info">
            <p class="settings-note">
              🎵 <strong>중앙 관리 서비스</strong><br>
              • API 키는 서버에서 중앙 관리됩니다<br>  
              • 1인당 최대 2개의 음악을 생성할 수 있습니다<br>
              • IP 주소를 기준으로 사용량을 추적합니다
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- 매력 선택 모달 -->
    <div id="picker" class="modal hidden" aria-hidden="true">
      <div class="modal-content charm-modal-content">
        <div class="modal-header">
          <strong>매력 선택하기</strong>
          <button id="picker-close" type="button" class="close-btn">×</button>
        </div>
        <div class="picker-body">
          <div class="picker-categories" id="picker-categories"></div>
          <div class="picker-charms" id="picker-charms">
            <div class="hint">카테고리를 클릭하면 세부 매력이 표시됩니다.</div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <small>© Aster Alarm</small>
    </footer>

    <script type="module" src="./js/app.js"></script>
  </body>
</html>

