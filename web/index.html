<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aster Alarm – 알람 음악 생성</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header>
      <h1>Aster Alarm · 알람 음악 생성</h1>
      <p>매력 입력 → 프롬프트 자동 생성 → Gemini 최적화 → 음악 생성.</p>
    </header>

    <main>
      <section class="panel">
        <h2>1) 별자리 입력</h2>
        <div class="grid">
          <div>
            <label>매력</label>
            <div id="traits-container"></div>
            <div class="row">
              <button id="add-trait" type="button">+ 매력 추가</button>
              <button id="clear-traits" type="button" class="secondary">초기화</button>
            </div>
            <details class="mt8">
              <summary>JSON 내보내기/불러오기</summary>
              <textarea id="traits-json" rows="6" placeholder='{
  "traits": [
    {"charm_name": "침착성", "stage": 6},
    {"charm_name": "안정감", "stage": 5}
  ]
}'></textarea>
              <div class="row">
                <button id="load-json" type="button">JSON 불러오기</button>
                <button id="export-json" type="button" class="secondary">JSON 내보내기</button>
              </div>
            </details>
          </div>
          <div>
            <label>길이 선택</label>
            <div class="row">
              <div class="field">
                <select id="duration_select">
                  <option value="30">30초</option>
                  <option value="60">1분 (60초)</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>2) AI 생성</h2>
        <p class="note">설정의 Gemini API 키가 필요합니다. 버튼 하나로 프롬프트 생성→최적화→음악 생성이 순차 실행됩니다.</p>
        <div class="row">
          <input id="api-endpoint" placeholder="http://localhost:8080/generate" />
          <button id="generate" type="button" disabled>음악 생성</button>
        </div>
        <div id="gen-status" class="status"></div>
      </section>

      <section class="panel">
        <h2>설정</h2>
        <div class="grid">
          <div>
            <label>Gemini API 키 (AI Studio)</label>
            <input id="gemini-api-key" type="password" placeholder="AIza..." />
            <div class="row mt8">
              <label>Gemini 모델</label>
              <input id="gemini-model" placeholder="gemini-.5-pro" />
            </div>
            <div class="row mt8">
              <button id="save-settings" type="button" class="secondary">설정 저장</button>
            </div>
            <p class="note">음악 생성은 서버 엔드포인트를 사용합니다. 로컬 서버가 켜져 있으면 기본값으로 동작합니다.</p>
          </div>
        </div>
      </section>

      <!-- 매력 선택 모달 -->
      <div id="picker" class="modal hidden" aria-hidden="true">
        <div class="modal-content">
          <div class="modal-header">
            <strong>매력 선택</strong>
            <button id="picker-close" type="button" class="icon">×</button>
          </div>
          <div class="picker-body">
            <div class="picker-categories" id="picker-categories"></div>
            <div class="picker-charms" id="picker-charms">
              <div class="hint">카테고리를 클릭하면 세부 매력이 표시됩니다.</div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <small>© Aster Alarm</small>
    </footer>

    <script type="module" src="./js/app.js"></script>
  </body>
</html>
